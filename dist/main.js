(()=>{document.getElementById("canvas").getContext("2d");var e=["asset/Field.png"];for(let t=1;t<12;t++)e[t]="asset/Sprite_"+2**t+".png";function t(e,t){return{x:84*e-37.5,y:87*t-37.5}}function c(e,t,c=0){let[r,i]=function(e){let t=e.flat();for(;;){let e=Math.floor(16*Math.random());if(-1===t[e])return[Math.floor(e/4),e%4];if(t.every((e=>-1===e)))break}}(t),o=(1===c?1:.9)>Math.random()?1:2;t[r][i]=new n(o,i+1,4-r),e.addChild(t[r][i],2),t[r][i].setScale(.1,.1);let a=cc.ScaleTo.create(.4,1,1);t[r][i].runAction(a)}e.push("asset/CountField.png");var n=cc.Sprite.extend({ctor:function(e,t,c){this._super("asset/Sprite_"+2**e+".png"),this.number=e,this.setPosition(84*t-37.5,87*c-37.5)},fusion:function(e){this._super("asset/Sprite_"+2**e+".png"),this.number=e}}),r=cc.Layer.extend({ctor:function(t){this._super();var c=cc.director.getWinSize(),n=cc.Sprite.create(e[0]);n.setPosition(c.width/2,191.5),this.addChild(n,0);var r=cc.Sprite.create(e[-1]);r.setPosition(c.width/2,c.height-52),this.addChild(r,0),t="СЧЁТ: "+t;var i=new cc.LabelTTF(t,"Arial",32);i.x=c.width/2,i.y=c.height-52,i.setFontFillColor(0,0,0),this.addChild(i,1)}}),i=cc.Layer.extend({ctor:function(){this._super()}});window.onload=function(){cc.game.onStart=function(){cc.LoaderScene.preload(e,(function(){cc.director.setDisplayStats(!1);var n=cc.Scene.extend({onEnter:function(){this._super();let n=new r(0);this.addChild(n,1);let o=new i;o.setPosition(25,11),this.addChild(o,1);var a=Array(4).fill(-1).map((e=>Array(4).fill(-1)));c(o,a,1),c(o,a,1),cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseDown:function(e){prevX=e._x,prevY=e._y},onMouseUp:function(n){if(nextX=n._x,nextY=n._y,diffX=Math.abs(nextX)-Math.abs(prevX),diffY=Math.abs(nextY)-Math.abs(prevY),Math.abs(diffX)>50||Math.abs(diffY)>50){let n=Math.abs(diffX)>Math.abs(diffY)?diffX>0?"right":"left":diffY>0?"up":"down";switch(console.log(n),n){case"left":for(let c=0;c<4;c++){let n=a[c].filter((e=>-1!=e));a[c].fill(-1),n.forEach(((e,r)=>{a[c][r]=n[r];let i=cc.MoveTo.create(.5,cc.p(t(r+1,4-c)));a[c][r].runAction(i)})),a[c].forEach(((n,r)=>{if(-1!=n&&3!=r&&a[c][r].number===a[c][r+1].number){let n=cc.MoveTo.create(.5,cc.p(t(r+2,4-c)));a[c][r+1].runAction(n),a[c].splice(r,1),a[c].pop(-1),a[c][r+1].number=a[c][r+1].number+1,a[c][r+1].spriteFrame=e[number],a[c][r+1].setScale(1.4,1.4);let i=cc.ScaleTo.create(.4,1,1);a[c][r+1].runAction(i)}}))}break;case"right":for(let e=0;e<4;e++){let c=a[e].filter((e=>-1!=e));a[e].fill(-1),c.forEach(((n,r)=>{a[e][4-c.length+r]=c[r];let i=cc.MoveTo.create(.5,cc.p(t(4-c.length+r+1,4-e)));a[e][4-c.length+r].runAction(i)}))}break;case"up":for(let e=0;e<4;e++){let c=[];for(let t=0;t<4;t++)-1!=a[t][e]&&(c.push(a[t][e]),a[t][e]=-1);c.forEach(((n,r)=>{a[r][e]=c[r];let i=cc.MoveTo.create(.5,cc.p(t(e+1,4-r)));a[r][e].runAction(i)}))}break;case"down":for(let e=0;e<4;e++){let c=[];for(let t=3;t>-1;t--)-1!=a[t][e]&&(c.push(a[t][e]),a[t][e]=-1);c.forEach(((n,r)=>{a[3-r][e]=c[r];let i=cc.MoveTo.create(.5,cc.p(t(e+1,r+1)));a[3-r][e].runAction(i)}))}}setTimeout(c,400,o,a)}}},this)}});cc.director.runScene(new n)}),this)},cc.game.run("canvas")}})();